---
/**
 * VersionInfo component - displays build version and date
 * Reads version information from version.json generated by version.ps1
 */

import { readFile } from 'node:fs/promises';
import { join } from 'node:path';

interface VersionData {
  BuildNumber: string;
  BuildDate: string;
  BuildHost: string | null;
  CommitHash: string;
  CurrentUser: string | null;
  GitBranch: string;
  GitHead: string;
  GitTag: string;
}

let version: VersionData | null = null;
let _error = false;

try {
  const versionPath = join(process.cwd(), 'public', 'version.json');
  const content = await readFile(versionPath, 'utf-8');
  version = JSON.parse(content);
} catch (_e) {
  _error = true;
}

// Format the build date if available
let formattedDate = '';
if (version?.BuildDate) {
  try {
    const date = new Date(version.BuildDate);
    formattedDate = date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
    });
  } catch {
    formattedDate = version.BuildDate;
  }
}
---

{
  version && !_error && (
    <div class="text-xs text-gray-400 space-y-0.5">
      <div>
        <span class="font-medium">Version:</span>
        <span class="ml-1">{version.GitTag}</span>
        {version.CommitHash && <span class="ml-1 font-mono">({version.CommitHash})</span>}
      </div>
      {formattedDate && (
        <div>
          <span class="font-medium">Build:</span>
          <span class="ml-1">{formattedDate}</span>
        </div>
      )}
    </div>
  )
}

{_error && <div class="text-xs text-gray-500">Version info unavailable</div>}
